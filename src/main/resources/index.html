<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Scale continuum</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
</head>
<body>

<section class="bg-primary" id="controls">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 text-center">
                <h2 class="section-heading">Scale continuum Demo</h2>
                <hr class="light"/>
                <p class="text-faded">
                    Please choose the dataset size and the cache configuration.<br/>
                    Then press the 'Start' button to execute the demo. The performance of fetching data will be
                    displayed below
                </p>
                <hr class="light"/>
                <p>
                <form name="form" id="form">
                    <label>
                        Dataset size:
                        <select name="datasetSize">
                            <option value="100M">100 MB</option>
                            <option value="1G">1 GB</option>
                            <option value="10G">10 GB</option>
                            <option value="100G">100 GB</option>
                        </select>
                    </label>

                    <label>
                        Enable cache:
                        <input type="checkbox" name="cacheEnabled"/>
                    </label>

                    <label>
                        Enable Heap:
                        <input type="checkbox" name="heapEnabled"/>
                    </label>

                    <label>
                        Heap size:
                        <input type="text" name="heapSize"/>
                    </label>

                    <input type="submit" id="start" value="Start" class="page-scroll btn btn-default btn-xl sr-button"/>
                </form>
                </p>
            </div>
        </div>
    </div>
</section>

<section id="graphs">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <canvas id="tps" width="960" height="350"></canvas><br/>
                <canvas id="latencies" width="1000" height="350"></canvas>
            </div>
        </div>
    </div>
</section>

<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/smoothie.js"></script>
<script type="application/javascript">
    $(document).ready(function () {

        var tpsLine = new TimeSeries();
        var latenciesLine = new TimeSeries();

//        bind submit button to call Rest start command
        $('#form').submit(function (event) {
            var data = $('form').serializeArray();
            $.post("/start", JSON.stringify(data), "json")
                    .fail(function () {
                        alert("error");
                    })
                    .done(function () {
                        var tpsSmoothie = new SmoothieChart({
                            grid: { strokeStyle:'rgb(125, 0, 0)', fillStyle:'rgb(60, 0, 0)',
                                lineWidth: 1, millisPerLine: 1000, verticalSections: 6, },
                            labels: { fillStyle:'rgb(60, 0, 0)' }
                        });
                        tpsSmoothie.streamTo(document.getElementById("tps"));

                        var latenciesSmoothie = new SmoothieChart({
                            grid: { strokeStyle:'rgb(125, 0, 0)', fillStyle:'rgb(0, 60, 0)',
                                lineWidth: 1, millisPerLine: 1000, verticalSections: 6, },
                            labels: { fillStyle:'rgb(60, 0, 0)' }
                        });
                        latenciesSmoothie.streamTo(document.getElementById("latencies"));

                        setInterval(function () {
                            $.get('/stats', function(data) {
                                $.each(data, function() {
                                    tpsLine.append(this['timestamp'], this['periodicTps']);
                                    latenciesLine.append(this['timestamp'], this['periodicAverageLatencyInMs']);
                                })
                            })
                        }, 1000);
                        tpsSmoothie.addTimeSeries(tpsLine, 1000, { strokeStyle:'rgb(0, 255, 0)', fillStyle:'rgba(0, 255, 0, 0.4)', lineWidth:3 } );
                        latenciesSmoothie.addTimeSeries(latenciesLine, 1000, { strokeStyle:'rgb(0, 255, 0)', fillStyle:'rgba(0, 255, 0, 0.4)', lineWidth:3 } );
                    });
            event.preventDefault();
        });

    });
</script>
</body>
</html>